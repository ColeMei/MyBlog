{{ if or (.Site.Params.global_mathjax) (.Params.mathjax) }}
  {{ $mathjaxConfig := resources.Get "js/mathjax-assistant.js" | minify | fingerprint }}
  <script type="text/javascript" id="MathJax-config" defer src="{{ $mathjaxConfig.Permalink }}" {{ printf "integrity=%q" $mathjaxConfig.Data.Integrity | safeHTMLAttr }} crossorigin="anonymous"></script>
  {{- with $mathjaxLib := $.Site.Params.mathjaxLib | default "https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" -}}
    {{- if not (or (findRE `http[s]{0,1}://` $mathjaxLib 1) (findRE `^\/.*` $mathjaxLib 1)) -}}
      {{ $mj := resources.Get $mathjaxLib }}
      <script id="MathJax-script" type="text/javascript" defer src="{{ $mj.Permalink }}" {{ printf "integrity=%q" $mj.Data.Integrity | safeHTMLAttr }} crossorigin="anonymous"></script>
    {{- else if findRE `^\/.*` $mathjaxLib 1 -}}
      {{ $mj := printf "%s%s" $.Site.BaseURL (strings.TrimLeft "/" $mathjaxLib) }}
      <script id="MathJax-script" type="text/javascript" defer src="{{ $mj }}" crossorigin="anonymous"></script>
    {{- else -}}
      <script id="MathJax-script" type="text/javascript" defer src="{{ $mathjaxLib }}" crossorigin="anonymous"></script>
    {{- end -}}
  {{- end -}}
{{ end }}
